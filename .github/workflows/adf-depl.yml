# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:


jobs:
  
  build:    
    runs-on: ubuntu-latest
    env:
      env_str: test
      env_str_rg: Test
    
    steps:      
      - name: Checkout the repo
        uses: actions/checkout@v3

      - name: adf
        run: |
          echo $GITHUB_WORKSPACE
          ls -ltr adf    

      - name: just check
        run: echo $env_str
         
          
      - name: Login via Az module
        uses: azure/login@v1
        with:
           creds: ${{ secrets.AZURE_CREDENTIALS_1 }}
           enable-AzPSSession: true 
      - name: Deploy resources
        uses: Azure/data-factory-deploy-action@v1.2.0
        with:
          resourceGroupName: RG_Learn_Depl_${{env.env_str_rg}}
          dataFactoryName: tk-sb-adf-${{env.env_str}}
          armTemplateFile: adf/ARMTemplateForFactory.json
          armTemplateParametersFile: adf/ARMTemplateParametersForFactory.json
          additionalParameters: 'MPE_Dev_SqlDB_properties_privateLinkResourceId=/subscriptions/0817546b-75ca-4d4f-8319-505d8a966431/resourceGroups/RG_Learn_Depl_${{env.env_str_rg}}/providers/Microsoft.Sql/servers/mssql-srv-${{env.env_str}}
                                 LS_KV_properties_typeProperties_baseUrl=https://tk-sb-kv-${{env.env_str}}.vault.azure.net/'
